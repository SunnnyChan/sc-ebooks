# 服务路由

## 透明化路由
```md
透明化路由是指 消费者只需要知道当前系统发布了哪些服务，而不需要知道服务具体部署于什么位置。

主要是基于服务注册中心的订阅发布机制。
```
## 负载均衡
* 随机
* 轮询
* 服务调用时延
* 一致性Hash
* 粘滞连接
```md
粘滞连接用于有状态服务，尽可能让客户端总是向同一服务提供者发起服务调用，除非该服务提供者异常。
一般情况下，服务通常被强烈建议设计为 无状态，因此，粘滞连接不太常用。
```
## 本地路由优先策略
* injvm 模式
```md
本地 JVM 内部发布了服务。该场景下，从性能、可靠性考虑，需要优先调用本地 JVM 内部的服务提供者。
这种本地优先的路由模式被称为 injvm 模式。
```
* innative 模式
```md
当多个服务部署到同一台机器上，服务路由需要优先悬着本机的服务提供者，这种模式称为 innative 模式。

优势：
通信流量走本地网卡回环，不需要占用网络带宽。
```
## 路由规则
### 条件路由
* IP 黑白名单
* 流量引导
```md
只暴露部分服务提供者，防止整个服务都被冲垮。
```
* 读写分离
* 前后台分离
* 灰度升级

### 脚本路由

## 路由策略制定
* 自定义路由
* 路由扩展策略

## 配置化路由
* 本地配置
* 统一注册管理
* 动态下发

## 最佳实践 — 多机房路由
> 解决方案
* 条件路由
* 虚拟分组

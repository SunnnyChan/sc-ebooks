# 使用微服务
> 一个服务提供了应用中其他服务所需要的某些能力。   
> 每个服务都是一个独立的组件，独立的条件：
```md
* 维护自己的代码块
* 管理自己的数据
* 向其他服务提供能力
* 消费其他服务的能力
* 单一 所有者
```

### 如何定义服务
```md
整个行业正想着更小的微服务的趋势发展。
Docker等技术的发展使得大量的微服务称为一种可能的系统拓扑。
```

#### 如何决定服务边界
```md
公司组织、文化以及应用程序的类型都会在很大程度上影响服务边界的确定。
```
##### 一组指导原则：
* 特定的业务需求
```md
某些情况下特定的业务需求会决定一个服务的边界。
这些需求可能来至监管、法律、安全或者一些关键业务。

* 如： 支付
假设你的系统接收来至用户的在线信用卡支付，应该如何收集、处理并存储这些信用卡？
一个好的策略是将处理信用卡的逻辑作为一个独立的服务，原因是：
> 法律/监管需求
> 安全
出于安全的考虑，你可能需要额外的防火墙来保护这些服务器。
> 校验
可能需要对这些能力进行更加严格的产品测试，来保证他们的安全性。
> 限制性访问
通常会希望限制对这些服务的访问，这样只有必须人员才能访问高度敏感的支付信息。
```
* 清晰和独立的团队所有权
```md
服务能够将更小的、清晰的、独立的模块所有权赋予不同的团队。

* 一般原则
一个单独的服务一般由3-8人的团队来负责，团队应该负责服务的所有方面。

这样就减少了团队之间的依赖，是的独立的团队更容易维护系统和实现创新。

* 团队所有权
单个团队可以负责多个服务。关键是要确认这个团队可以负责该服务的所有方面。

* 处于安全原因隔离团队
有时候希望限制能够访问某个服务代码的人员数量和范围。
可以从物理上限制只有关键人员才能访问服务相关的代码、数据和系统。
将敏感数据分成多个服务，每个服务由不同团队管理，也可以有效降低多个服务同时泄漏数据的风险。

处于安全考虑的数据拆分：
信用卡数字和其他必须的信息可以存放在不同的服务中。
甚至可以选择不保存信用卡号，而将它们存储在一个第三方信用卡服务公司的服务中。
```
* 天然隔离的数据
```md
服务的一个要求是，其托管状态和数据需要和其他数据相隔离。
出于多种原因，让多个代码库对同一组数据进行操作是有问题的。
只有在隔离数据后，隔离代码和所有权才能启作用。

确定数据划分界线是确定服务划分界线的关键环节。
对于一个服务来说，是否能够负责自己的数据，并通过外部接口提供数据访问，决定了改服务是否有一个好的服务边界。
```
* 共享的能力 / 数据
```md
用户身份服务：
这个数据服务可能不复杂，但它最终负责所有用户的信息，这些信息通常被大量的服务使用。
通过一个中心服务来提供和管理这些信息，在实际中非常实用。
```

#### 多种原因
```md
对于以上原则描述的是决定服务边界的基本标准，但大多数情况下需要考虑多种原因才能最终做出决定。
必须同时运用你的判断力和这些标准，可能还要考虑公司的业务逻辑和需要，以及特定的业务需求。
```

#### 过犹不及
```md
通常一个服务拆分成多个服务：
* 降低单个服务的复杂度（通常是这样）
* 增加了系统的复杂度

服务力度拆分过细带来的问题：
* 可能导致整体系统性能下降
* 影响大局观
  想要记住整体系统框架变得越来越难。
* 更大故障几率
  更多的独立组件之间需要相互工作。
* 难以修改服务
  增加了修改服务队使用者的影响。
* 更多依赖

许多问题可以通过在服务间定义清晰的接口边界来缓解，但这不是一个完美的解决方案。
```
#### 适当的平衡
```md
最终，决定服务的数量和每个服务的复杂度，是一个很复杂的问题。
它需要创建更多服务带来的好处，以及创建整体更复杂的系统所带来的坏处之间做权衡。

在系统、组织和公司文化之间找到平衡，对于充分利用微服务的好处非常重要。
```
